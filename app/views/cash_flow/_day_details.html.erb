<%= turbo_frame_tag "day_details" do %>
  <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50" data-controller="modal" data-action="keydown.esc->modal#close click->modal#closeOnBackdrop">
    <div class="bg-container rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-[80vh] overflow-hidden" data-modal-target="content">
      <div class="flex items-center justify-between p-4 border-b border-secondary">
        <h3 class="text-lg font-medium text-primary">
          <%= l(date, format: :long) %>
        </h3>
        <%= link_to cash_flow_path, data: { turbo_frame: "day_details" }, class: "p-2 rounded-lg hover:bg-surface-inset transition-colors" do %>
          <%= icon("x", class: "w-5 h-5 text-secondary") %>
        <% end %>
      </div>

      <div class="p-4 overflow-y-auto max-h-96">
        <% if projections.any? %>
          <div class="space-y-3">
            <% projections.each do |projection| %>
              <div class="flex items-center justify-between p-3 rounded-lg bg-surface-inset">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full flex items-center justify-center <%= projection[:type] == :income ? 'bg-success/10' : 'bg-destructive/10' %>">
                    <%= icon(projection[:type] == :income ? "arrow-down-left" : "arrow-up-right",
                        class: "w-4 h-4 #{projection[:type] == :income ? 'text-success' : 'text-destructive'}") %>
                  </div>
                  <div>
                    <p class="text-sm font-medium text-primary"><%= projection[:description] %></p>
                    <p class="text-xs text-subdued">
                      <%= t(".source_#{projection[:source]}") %>
                      <% if projection[:confidence] %>
                        Â· <%= t(".confidence", value: (projection[:confidence] * 100).round) %>
                      <% end %>
                    </p>
                  </div>
                </div>
                <div class="text-right">
                  <p class="text-sm font-medium <%= projection[:type] == :income ? 'text-success' : 'text-destructive' %>">
                    <%= projection[:type] == :income ? '+' : '-' %><%= number_to_currency(projection[:amount]) %>
                  </p>
                  <% if projection[:amount_min].present? && projection[:amount_max].present? && projection[:amount_min] != projection[:amount_max] %>
                    <p class="text-xs text-subdued">
                      <%= t(".range", min: number_to_currency(projection[:amount_min]), max: number_to_currency(projection[:amount_max])) %>
                    </p>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>

          <%# Day Summary %>
          <div class="mt-4 pt-4 border-t border-secondary">
            <% total_income = projections.select { |p| p[:type] == :income }.sum { |p| p[:amount].to_f } %>
            <% total_expenses = projections.select { |p| p[:type] == :expense }.sum { |p| p[:amount].to_f } %>
            <% net = total_income - total_expenses %>

            <div class="flex items-center justify-between text-sm">
              <span class="text-secondary"><%= t(".net_for_day") %></span>
              <span class="font-medium <%= net >= 0 ? 'text-success' : 'text-destructive' %>">
                <%= net >= 0 ? '+' : '' %><%= number_to_currency(net) %>
              </span>
            </div>
          </div>
        <% else %>
          <div class="text-center py-8">
            <%= icon("calendar", class: "w-12 h-12 text-subdued mx-auto mb-3") %>
            <p class="text-secondary"><%= t(".no_projections") %></p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
