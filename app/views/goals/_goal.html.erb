<%= turbo_frame_tag dom_id(goal) do %>
  <%= link_to goal_path(goal), class: "block bg-container-inset hover:bg-container-hover rounded-lg p-4 transition-colors" do %>
    <div class="flex items-start justify-between mb-3">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background-color: <%= goal.color || '#3B82F6' %>20">
          <%= icon(goal.lucide_icon || "target", class: "w-5 h-5", style: "color: #{goal.color || '#3B82F6'}") %>
        </div>
        <div>
          <h3 class="text-primary font-medium"><%= goal.name %></h3>
          <p class="text-xs text-secondary">
            <%= t("goals.goal_types.#{goal.goal_type}") %>
            <% if goal.days_remaining %>
              <span class="text-subdued">&middot;</span>
              <%= t(".days_remaining", count: goal.days_remaining) %>
            <% end %>
          </p>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <% case goal.tracking_status %>
        <% when "completed" %>
          <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-success/10 text-success">
            <%= icon("check", class: "w-3 h-3") %>
            <%= t(".status.completed") %>
          </span>
        <% when "on_track" %>
          <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-success/10 text-success">
            <%= t(".status.on_track") %>
          </span>
        <% when "behind" %>
          <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-warning/10 text-warning">
            <%= t(".status.behind") %>
          </span>
        <% end %>
      </div>
    </div>

    <div class="space-y-2">
      <div class="flex items-center justify-between text-sm">
        <span class="text-secondary">
          <%= format_money(Money.new(goal.current_amount, goal.currency)) %>
        </span>
        <span class="text-primary font-medium">
          <%= format_money(Money.new(goal.target_amount, goal.currency)) %>
        </span>
      </div>

      <div class="relative h-2 bg-container rounded-full overflow-hidden">
        <div
          class="absolute inset-y-0 left-0 rounded-full transition-all duration-500"
          style="width: <%= [goal.progress_percentage, 100].min %>%; background-color: <%= goal.color || '#3B82F6' %>"
        ></div>

        <% goal.milestones&.each do |milestone| %>
          <% if milestone["reached_at"].present? %>
            <div
              class="absolute top-1/2 -translate-y-1/2 w-1 h-3 bg-white rounded-full shadow"
              style="left: <%= milestone['percentage'] %>%"
            ></div>
          <% end %>
        <% end %>
      </div>

      <div class="flex items-center justify-between text-xs text-subdued">
        <span><%= goal.progress_percentage.round(1) %>%</span>
        <% if goal.required_monthly_contribution && goal.required_monthly_contribution > 0 %>
          <span><%= t(".monthly_needed", amount: format_money(Money.new(goal.required_monthly_contribution, goal.currency))) %></span>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>
